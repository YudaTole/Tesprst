<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Video + Preset & XML</title>
  <meta name="description" content="Pemutar video dari Google Drive dengan tombol Preset Alight Motion dan XML judul/by." />
  <style>
    :root{--bg:#0b0f16;--card:#121826;--muted:#8ea0b6;--text:#e6edf7;--acc:#5ac8fa;--acc2:#22d3ee;--ring:#2b3548}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b0f16,#0e1522);color:var(--text);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial}
    a{color:var(--acc)}
    .wrap{max-width:980px;margin-inline:auto;padding:20px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:40px;height:40px;border-radius:12px;background:radial-gradient(circle at 30% 30%, #22d3ee, #2563eb);box-shadow:0 6px 20px #0b728533}
    .title{font-weight:700;font-size:1.1rem}
    .card{background:rgba(255,255,255,0.03);backdrop-filter:blur(6px);border:1px solid #1e2636;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .video-card{padding:10px}
    .video{position:relative;padding-top:56.25%;border-radius:12px;overflow:hidden;border:1px solid #20304b;background:#000}
    .video iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
    .grid{display:grid;gap:14px}
    @media(min-width:800px){.grid{grid-template-columns:1.2fr .8fr}}
    .section{padding:16px}
    .section h2{margin:0 0 10px;font-size:1rem}
    .btn{appearance:none;border:1px solid #24405f;background:linear-gradient(180deg,#172338,#111827);color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;display:flex;align-items:center;gap:8px;justify-content:center;font-weight:600;transition:transform .05s ease, border-color .2s}
    .btn:hover{border-color:#2e8bc6}
    .btn:active{transform:translateY(1px)}
    .btn.full{width:100%}
    .btn.row{justify-content:flex-start}
    .row{display:flex;gap:10px;align-items:center}
    .stack{display:flex;flex-direction:column;gap:10px}
    .input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #233149;background:#0c1421;color:var(--text)}
    .muted{color:var(--muted);font-size:.9rem}
    .chip{display:inline-flex;align-items:center;gap:6px;border:1px solid #233149;background:#0e1a2b;color:#9ec7ff;padding:6px 10px;border-radius:999px;font-size:.8rem}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#101826;border:1px solid #233149;padding:2px 6px;border-radius:6px}
    footer{opacity:.75;font-size:.85rem;padding:18px;text-align:center}
    .two{display:grid;gap:10px;grid-template-columns:1fr 1fr}
    .two .btn{white-space:nowrap}
    .code{background:#0b1220;border:1px solid #22314d;border-radius:12px;padding:10px;font-family:ui-monospace,Consolas,monospace;font-size:.9rem;overflow:auto}
    .small{font-size:.85rem}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand"><div class="logo" aria-hidden="true"></div><div>
        <div class="title">Pemutar GDrive + Preset & XML</div>
        <div class="muted small">Tempel link Google Drive & preset Alight Motion. Salin/unduh XML teks judul & by.</div>
      </div></div>
      <span class="chip">Tip: tekan <span class="kbd">Ctrl</span>+<span class="kbd">D</span> untuk bookmark</span>
    </header>

    <div class="grid">
      <!-- LEFT: VIDEO -->
      <div class="card video-card">
        <div class="stack">
          <label class="muted small">Link Google Drive (sharing atau file ID)</label>
          <input id="driveInput" class="input" placeholder="Contoh: https://drive.google.com/file/d/FILE_ID/view?usp=drive_link" />
          <button class="btn full" id="loadBtn">Tampilkan Video</button>
          <div class="video" id="videoWrap" hidden>
            <iframe id="player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen loading="lazy"></iframe>
          </div>
          <div id="dlRow" class="row" hidden>
            <span class="muted small">Direct download:</span>
            <a id="dlLink" target="_blank" rel="noopener" class="chip">Buka tautan unduhan</a>
          </div>
          <div class="muted small">Catatan: pastikan file di Drive di-set <em>Anyone with the link</em> agar bisa diputar.</div>
        </div>
      </div>

      <!-- RIGHT: LINKS & XML -->
      <div class="card section">
        <h2>Preset & XML</h2>
        <div class="stack">
          <label class="muted small">Link Preset Alight Motion</label>
          <input id="presetInput" class="input" placeholder="Tempel link preset AM di sini" />
          <div class="two">
            <a id="openPreset" class="btn" target="_blank" rel="noopener">Buka Preset</a>
            <button id="copyPreset" class="btn">Salin Link</button>
          </div>
        </div>

        <div style="height:10px"></div>
        <h2>XML: Judul & By</h2>
        <div class="stack">
          <label class="muted small">Judul</label>
          <textarea id="judulText" class="input" rows="2" placeholder="Contoh: Nightcore - Song Title"></textarea>
          <div class="two">
            <button class="btn" id="copyJudul">Salin</button>
            <button class="btn" id="downloadJudul">Download judul.xml</button>
          </div>
        </div>
        <div class="stack" style="margin-top:8px">
          <label class="muted small">By</label>
          <textarea id="byText" class="input" rows="2" placeholder="Contoh: By Akume Yume Ai"></textarea>
          <div class="two">
            <button class="btn" id="copyBy">Salin</button>
            <button class="btn" id="downloadBy">Download by.xml</button>
          </div>
        </div>

        <details style="margin-top:14px">
          <summary class="muted">Lihat contoh isi XML</summary>
          <div class="code small" id="xmlPreview"></div>
        </details>

        <div class="muted small" style="margin-top:10px">Gunakan parameter URL untuk otomatis terisi: <code>?drive=...&preset=...&judul=...&by=...</code></div>
      </div>
    </div>

    <footer>
      Dibuat untuk Yuda Â· Kompatibel dengan GitHub Pages. 
    </footer>
  </div>

  <script>
    // --- Helper: ambil parameter query ---
    const qs = new URLSearchParams(location.search);

    // --- Elemen ---
    const driveInput = document.getElementById('driveInput');
    const presetInput = document.getElementById('presetInput');
    const openPreset = document.getElementById('openPreset');
    const copyPreset = document.getElementById('copyPreset');
    const loadBtn = document.getElementById('loadBtn');
    const player = document.getElementById('player');
    const videoWrap = document.getElementById('videoWrap');
    const dlRow = document.getElementById('dlRow');
    const dlLink = document.getElementById('dlLink');
    const judulText = document.getElementById('judulText');
    const byText = document.getElementById('byText');
    const copyJudul = document.getElementById('copyJudul');
    const copyBy = document.getElementById('copyBy');
    const downloadJudul = document.getElementById('downloadJudul');
    const downloadBy = document.getElementById('downloadBy');
    const xmlPreview = document.getElementById('xmlPreview');

    // --- Prefill dari query ---
    if(qs.get('drive')) driveInput.value = decodeURIComponent(qs.get('drive'));
    if(qs.get('preset')) presetInput.value = decodeURIComponent(qs.get('preset'));
    if(qs.get('judul')) judulText.value = decodeURIComponent(qs.get('judul'));
    if(qs.get('by')) byText.value = decodeURIComponent(qs.get('by'));

    // --- Parsing Google Drive link -> fileId ---
    function extractDriveId(input){
      if(!input) return '';
      const s = input.trim();
      // 1) full file link: /file/d/FILE_ID/
      let m = s.match(/\/file\/d\/([a-zA-Z0-9_-]{10,})/);
      if(m) return m[1];
      // 2) open?id=FILE_ID
      m = s.match(/[?&]id=([a-zA-Z0-9_-]{10,})/);
      if(m) return m[1];
      // 3) mungkin user langsung isi FILE_ID
      if(/^[a-zA-Z0-9_-]{20,}$/.test(s)) return s;
      return '';
    }

    function buildPreviewUrl(fileId){
      return `https://drive.google.com/file/d/${fileId}/preview`;
    }
    function buildDownloadUrl(fileId){
      return `https://drive.google.com/uc?export=download&id=${fileId}`;
    }

    function setVideo(link){
      const id = extractDriveId(link);
      if(!id){
        alert('Gagal membaca FILE_ID dari link Google Drive. Pastikan formatnya benar.');
        return;
      }
      const prev = buildPreviewUrl(id);
      const dl = buildDownloadUrl(id);
      player.src = prev;
      videoWrap.hidden = false;
      dlLink.href = dl;
      dlRow.hidden = false;
    }

    function updatePreset(){
      const url = presetInput.value.trim();
      openPreset.href = url || '#';
      openPreset.classList.toggle('muted', !url);
    }

    function xmlTemplate(text){
      // Template XML sederhana untuk teks statis.
      return `<?xml version="1.0" encoding="UTF-8"?>\n<text>\n  <content>${escapeXml(text)}</content>\n</text>`;
    }

    function escapeXml(s){
      return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&apos;');
    }

    function download(name, content){
      const blob = new Blob([content], {type:'application/xml'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = name; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 2000);
    }

    function refreshPreview(){
      const j = xmlTemplate(judulText.value || '');
      const b = xmlTemplate(byText.value || '');
      xmlPreview.textContent = `// judul.xml\n${j}\n\n// by.xml\n${b}`;
    }

    // --- Events ---
    loadBtn.addEventListener('click', ()=> setVideo(driveInput.value));
    presetInput.addEventListener('input', updatePreset);
    copyPreset.addEventListener('click', ()=> navigator.clipboard.writeText(presetInput.value || ''));

    copyJudul.addEventListener('click', ()=> navigator.clipboard.writeText(judulText.value || ''));
    copyBy.addEventListener('click', ()=> navigator.clipboard.writeText(byText.value || ''));
    downloadJudul.addEventListener('click', ()=> download('judul.xml', xmlTemplate(judulText.value || '')));
    downloadBy.addEventListener('click', ()=> download('by.xml', xmlTemplate(byText.value || '')));

    judulText.addEventListener('input', refreshPreview);
    byText.addEventListener('input', refreshPreview);

    // Init
    updatePreset();
    refreshPreview();

    // Auto-load video jika query disediakan
    if(driveInput.value) setVideo(driveInput.value);
  </script>
</body>
</html>
